#!/bin/bash

# ============================================
# image_to_base64.sh
# Convert image(s) to base64 encoded string(s)
# Usage: ./image_to_base64.sh <image_path> [output_file]
# ============================================

# Check if at least one argument is provided
if [ $# -lt 1 ]; then
    echo "Usage: image-to-base64 <image_path> [output_file]"
    echo "Example: image-to-base64 photo.png"
    echo "Example: image-to-base64 photo.png output.txt"
    exit 1
fi

IMAGE_PATH="$1"
OUTPUT_FILE="$2"

# Check if file exists
if [ ! -f "$IMAGE_PATH" ]; then
    echo "Error: File '$IMAGE_PATH' not found."
    exit 1
fi

# Check if base64 command is available
if ! command -v base64 &>/dev/null; then
    echo "Error: 'base64' command not found. Please install it."
    exit 1
fi

echo "Converting: $IMAGE_PATH"

# Convert to base64 (strip newlines for clean single-line output)
BASE64_STRING=$(base64 "$IMAGE_PATH" | tr -d '\n')

# Output to file or stdout
if [ -n "$OUTPUT_FILE" ]; then
    echo "$BASE64_STRING" >"$OUTPUT_FILE"
    echo "Done! Base64 saved to: $OUTPUT_FILE"
else
    echo ""
    echo "===== BASE64 OUTPUT ====="
    echo "$BASE64_STRING"
    echo "========================="
fi

# Print some info
FILE_SIZE=$(wc -c <"$IMAGE_PATH")
B64_LENGTH=${#BASE64_STRING}
echo ""
echo "Original file size : ${FILE_SIZE} bytes"
echo "Base64 string length: ${B64_LENGTH} chars"
